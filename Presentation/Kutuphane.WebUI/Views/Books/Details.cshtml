@model Kutuphane.Application.Dtos.BookDtos.BookWithCopiesDto

@{
    ViewData["Title"] = Model.Title;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container" style="margin-top: 40px; margin-bottom: 60px;">

    <!-- Geri Dön Butonu -->
    <div class="mb-3">
        <a asp-controller="Books" asp-action="Index" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Kitaplara Dön
        </a>
    </div>

    <div class="row">

        <!-- SOL TARAF - GÖRSEL -->
        <div class="col-lg-4 col-md-5">
            <div class="card shadow-sm mb-4">
                <div class="card-body text-center">
                    @if (!string.IsNullOrEmpty(Model.ImageUrl))
                    {
                        <img src="@Model.ImageUrl"
                             alt="@Model.Title"
                             class="img-fluid rounded"
                             style="max-height: 500px; width: auto;">
                    }
                    else
                    {
                        <img src="~/BookTemp/assets/img/placeholderBook.png"
                             alt="@Model.Title"
                             class="img-fluid rounded"
                             style="max-height: 500px; width: auto;">
                    }
                </div>
            </div>

            <!-- Kopya Durumu Kartı -->
            <div class="card shadow-sm">
                <div class="card-body">
                    <h6 class="card-title mb-3">
                        <i class="bi bi-files"></i> Kopya Durumu
                    </h6>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>Toplam Kopya:</span>
                        <span class="badge bg-info">@Model.TotalCopies</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Müsait Kopya:</span>
                        @if (Model.AvailableCopies > 0)
                        {
                            <span class="badge bg-success">@Model.AvailableCopies</span>
                        }
                        else
                        {
                            <span class="badge bg-danger">0</span>
                        }
                    </div>
                    <hr>
                    <small class="text-muted">
                        <i class="bi bi-info-circle"></i>
                        @if (Model.AvailableCopies > 0)
                        {
                            <span>Bu kitap şu anda ödünç alınabilir</span>
                        }
                        else
                        {
                            <span>Tüm kopyalar ödünçte</span>
                        }
                    </small>
                </div>
            </div>
        </div>

        <!-- SAĞ TARAF - DETAYLAR -->
        <div class="col-lg-8 col-md-7">
            <div class="card shadow-sm">
                <div class="card-body">

                    <!-- Başlık -->
                    <h2 class="mb-3">@Model.Title</h2>

                    <!-- Yazar -->
                    <h5 class="text-muted mb-4">
                        <i class="bi bi-person"></i> @Model.Author
                    </h5>

                    <!-- Kategori Badge -->
                    <div class="mb-4">
                        <span class="badge bg-primary fs-6">
                            <i class="bi bi-tag"></i> @Model.Category
                        </span>
                    </div>

                    <hr>

                    <!-- Kitap Bilgileri -->
                    <div class="row mb-4">
                        <div class="col-md-6 mb-3">
                            <strong><i class="bi bi-upc"></i> ISBN:</strong>
                            <p class="mb-0">@Model.ISBN</p>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.Publisher))
                        {
                            <div class="col-md-6 mb-3">
                                <strong><i class="bi bi-building"></i> Yayınevi:</strong>
                                <p class="mb-0">@Model.Publisher</p>
                            </div>
                        }

                        @if (Model.PublicationYear.HasValue)
                        {
                            <div class="col-md-6 mb-3">
                                <strong><i class="bi bi-calendar"></i> Yayın Yılı:</strong>
                                <p class="mb-0">@Model.PublicationYear</p>
                            </div>
                        }

                        <div class="col-md-6 mb-3">
                            <strong><i class="bi bi-translate"></i> Dil:</strong>
                            <p class="mb-0">@Model.Language</p>
                        </div>

                        @if (Model.PageCount.HasValue)
                        {
                            <div class="col-md-6 mb-3">
                                <strong><i class="bi bi-file-text"></i> Sayfa Sayısı:</strong>
                                <p class="mb-0">@Model.PageCount sayfa</p>
                            </div>
                        }
                    </div>

                    <hr>

                    <!-- Açıklama -->
                    @if (!string.IsNullOrEmpty(Model.Description))
                    {
                        <div class="mb-4">
                            <h5><i class="bi bi-card-text"></i> Açıklama</h5>
                            <p class="text-muted">@Model.Description</p>
                        </div>
                        <hr>
                    }

                    <!-- Ödünç Alma Butonu -->
                    <div class="d-grid gap-2">
                        @if (Model.AvailableCopies > 0)
                        {
                            <button class="btn btn-primary btn-lg" disabled>
                                <i class="bi bi-lock"></i> Ödünç Al (Giriş Gerekli)
                            </button>
                            <small class="text-muted text-center">
                                Ödünç almak için giriş yapmanız gerekmektedir
                            </small>
                        }
                        else
                        {
                            <button class="btn btn-secondary btn-lg" disabled>
                                <i class="bi bi-x-circle"></i> Müsait Kopya Yok
                            </button>
                        }
                    </div>

                </div>
            </div>

            <!-- Kopyalar Tablosu (Opsiyonel - Admin/Librarian için) -->
            @if (Model.Copies != null && Model.Copies.Any())
            {
                <div class="card shadow-sm mt-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="bi bi-list-ul"></i> Tüm Kopyalar
                        </h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Kopya No</th>
                                        <th>Durum</th>
                                        <th>Raf Konumu</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var copy in Model.Copies)
                                    {
                                        <tr>
                                            <td>@copy.CopyNumber</td>
                                            <td>
                                                @if (copy.Status == "Rafta")
                                                {
                                                    <span class="badge bg-success">@copy.Status</span>
                                                }
                                                else if (copy.Status == "Oduncte")
                                                {
                                                    <span class="badge bg-warning">Ödünçte</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-secondary">@copy.Status</span>
                                                }
                                            </td>
                                            <td>@copy.ShelfLocation</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }

        </div>

    </div>
</div>